<!DOCTYPE html>
<html lang="nl">
<head>
  <!-- 1) Basis -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- 2) Title + description (komen uit de pagina front matter) -->
  <title>
    {% if page.title %}{{ page.title }} | {% endif %}CPL Metaal
  </title>
  {% if page.description %}
    <meta name="description" content="{{ page.description | escape }}" />
  {% endif %}

  <!-- 3) Canonical (netjes voor SEO) -->
  <link rel="canonical" href="https://www.cplmetaal.com{{ page.url }}" />

  <!-- 4) Open Graph / Social -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.cplmetaal.com{{ page.url }}" />
  <meta property="og:title" content="{% if page.og_title %}{{ page.og_title | escape }}{% elsif page.title %}{{ page.title | escape }} | CPL Metaal{% else %}CPL Metaal{% endif %}" />
  {% if page.description %}
    <meta property="og:description" content="{{ page.description | escape }}" />
  {% endif %}
  <meta property="og:image" content="https://www.cplmetaal.com/logo.png" />

  <!-- 5) Favicon -->
  <link rel="icon" type="image/png" href="/favicon.png" />

  <!-- 6) Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Karla:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- 7) CSS (globaal) -->
  <link rel="stylesheet" href="/assets/css/variables.css" />
  <link rel="stylesheet" href="/assets/css/base.css" />
  <link rel="stylesheet" href="/assets/css/navigation.css" />

  <!-- 8) Extra CSS per pagina (optioneel) --> 
  {% if page.extra_css %} 
    {% for css_file in page.extra_css %}
      <link rel="stylesheet" href="{{ css_file }}" /> 
    {% endfor %} 
  {% endif %} 
</head>

<body class="{{ page.body_class | default: '' }}">

  <!-- Header (Jekyll include, vervangt navigation-placeholder + includes.js) -->
  {% include header.html %}

  <main id="main-content">
    {{ content }}
  </main>

  <!-- Footer (Jekyll include) -->
  {% include footer.html %}

<script>
(function () {
  const menuBtn = document.querySelector('.mobile-menu-btn');
  const menu = document.querySelector('.nav-menu');
  if (!menuBtn || !menu) return;

  const mobileMQ = window.matchMedia('(max-width: 992px)');

  function closeAllDropdowns() {
    document.querySelectorAll('.nav-item-dropdown').forEach((li) => {
      li.classList.remove('is-open');
      const toggleBtn = li.querySelector('.submenu-toggle');
      if (toggleBtn) toggleBtn.setAttribute('aria-expanded', 'false');
      const link = li.querySelector('.dropdown-link');
      if (link) link.setAttribute('aria-expanded', 'false');
    });
  }

  function toggleDropdown(li) {
    const isOpen = li.classList.toggle('is-open');

    // sync aria on both (link + button) if present
    const toggleBtn = li.querySelector('.submenu-toggle');
    if (toggleBtn) toggleBtn.setAttribute('aria-expanded', String(isOpen));

    const link = li.querySelector('.dropdown-link');
    if (link) link.setAttribute('aria-expanded', String(isOpen));

    return isOpen;
  }

  /* Toggle main mobile menu */
  menuBtn.addEventListener('click', () => {
    const isOpen = menu.classList.toggle('active');
    menuBtn.setAttribute('aria-expanded', String(isOpen));
    document.body.classList.toggle('no-scroll', isOpen);

    if (!isOpen) closeAllDropdowns();
  });

  /* Dropdown behavior */
  const dropdownItems = document.querySelectorAll('.nav-item-dropdown');

  dropdownItems.forEach((li) => {
    const row = li.querySelector('.nav-item-row');
    const link = li.querySelector('.dropdown-link');
    const btn = li.querySelector('.submenu-toggle');

    // Desktop hover is CSS-driven; click should navigate (link) normally.
    // Mobile: click on row (or link) toggles submenu and prevents navigation.
    if (row) {
      row.addEventListener('click', (e) => {
        if (!mobileMQ.matches) return; // only mobile

        // If click came from an <a>, prevent navigation on mobile
        if (e.target.closest('a')) {
          e.preventDefault();
        }

        // Toggle this dropdown (optioneel: sluit andere dropdowns)
        dropdownItems.forEach((other) => {
          if (other !== li) {
            other.classList.remove('is-open');
            const ob = other.querySelector('.submenu-toggle');
            if (ob) ob.setAttribute('aria-expanded', 'false');
            const ol = other.querySelector('.dropdown-link');
            if (ol) ol.setAttribute('aria-expanded', 'false');
          }
        });

        toggleDropdown(li);
      });
    }

    // Fallback: button toggles too (als je hem later weer toont)
    if (btn) {
      btn.addEventListener('click', (e) => {
        if (!mobileMQ.matches) return;
        e.preventDefault();
        e.stopPropagation();
        toggleDropdown(li);
      });
    }

    // Accessibility: on mobile, pressing Enter/Space on the link toggles (no navigation)
    if (link) {
      link.addEventListener('keydown', (e) => {
        if (!mobileMQ.matches) return;
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggleDropdown(li);
        }
      });
    }
  });

  /* Close dropdowns when a submenu link is clicked (mobile) */
  menu.addEventListener('click', (e) => {
    const a = e.target.closest('a');
    if (!a) return;

    // if user clicked a submenu item, close menu (mobile)
    if (mobileMQ.matches) {
      menu.classList.remove('active');
      menuBtn.setAttribute('aria-expanded', 'false');
      document.body.classList.remove('no-scroll');
      closeAllDropdowns();
    }
  });

})();
</script>
  
</body>
</html>
