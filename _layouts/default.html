<!DOCTYPE html>
<html lang="nl">
<head>
  <!-- 1) Basis -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- 2) Title + description (komen uit de pagina front matter) -->
  <title>
    {% if page.title %}{{ page.title }} | {% endif %}CPL Metaal
  </title>
  {% if page.description %}
    <meta name="description" content="{{ page.description | escape }}" />
  {% endif %}

  <!-- 3) Canonical (netjes voor SEO) -->
  <link rel="canonical" href="https://www.cplmetaal.com{{ page.url }}" />

  <!-- 4) Open Graph / Social -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.cplmetaal.com{{ page.url }}" />
  <meta property="og:title" content="{% if page.og_title %}{{ page.og_title | escape }}{% elsif page.title %}{{ page.title | escape }} | CPL Metaal{% else %}CPL Metaal{% endif %}" />
  {% if page.description %}
    <meta property="og:description" content="{{ page.description | escape }}" />
  {% endif %}
  <meta property="og:image" content="https://www.cplmetaal.com/logo.png" />

  <!-- 5) Favicon -->
  <link rel="icon" type="image/png" href="/favicon.png" />

  <!-- 6) Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Karla:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- 7) CSS (globaal) -->
  <link rel="stylesheet" href="/assets/css/variables.css" />
  <link rel="stylesheet" href="/assets/css/base.css" />
  <link rel="stylesheet" href="/assets/css/navigation.css" />

  <!-- 8) Extra CSS per pagina (optioneel) --> 
  {% if page.extra_css %} 
    {% for css_file in page.extra_css %}
      <link rel="stylesheet" href="{{ css_file }}" /> 
    {% endfor %} 
  {% endif %} 
</head>

<body class="{{ page.body_class | default: '' }}">

  <!-- Header (Jekyll include, vervangt navigation-placeholder + includes.js) -->
  {% include header.html %}

  <main id="main-content">
    {{ content }}
  </main>

  <!-- Footer (Jekyll include) -->
  {% include footer.html %}

<script>
(function () {
  const menuBtn = document.querySelector('.mobile-menu-btn');
  const menu = document.querySelector('.nav-menu');
  if (!menuBtn || !menu) return;

  const mobileMQ = window.matchMedia('(max-width: 992px)');

  function closeAllDropdowns() {
    menu.querySelectorAll('.nav-item-dropdown').forEach((li) => {
      li.classList.remove('is-open');
      const btn = li.querySelector('.submenu-toggle');
      if (btn) btn.setAttribute('aria-expanded', 'false');
      const link = li.querySelector('.dropdown-link');
      if (link) link.setAttribute('aria-expanded', 'false');
    });
  }

  function setDropdownState(li, open) {
    li.classList.toggle('is-open', open);
    const btn = li.querySelector('.submenu-toggle');
    if (btn) btn.setAttribute('aria-expanded', String(open));
    const link = li.querySelector('.dropdown-link');
    if (link) link.setAttribute('aria-expanded', String(open));
  }

  function toggleDropdown(li) {
    const willOpen = !li.classList.contains('is-open');
    // sluit andere dropdowns
    menu.querySelectorAll('.nav-item-dropdown.is-open').forEach((other) => {
      if (other !== li) setDropdownState(other, false);
    });
    setDropdownState(li, willOpen);
  }

  /* Main mobile menu open/close */
  menuBtn.addEventListener('click', () => {
    const isOpen = menu.classList.toggle('active');
    menuBtn.setAttribute('aria-expanded', String(isOpen));
    document.body.classList.toggle('no-scroll', isOpen);
    if (!isOpen) closeAllDropdowns();
  });

  /* ✅ Eén click-handler voor ALLES in het menu (mobiel) */
  menu.addEventListener('click', (e) => {
    if (!mobileMQ.matches) return;

    const row = e.target.closest('.nav-item-dropdown .nav-item-row');
    const submenuLink = e.target.closest('.dropdown-menu a');
    const anyLink = e.target.closest('a');

    // 1) Klik op dropdown-rij (Producten/Toepassingen): toggle, NIET sluiten, NIET navigeren
    if (row) {
      const li = row.closest('.nav-item-dropdown');
      if (!li) return;

      e.preventDefault();     // voorkomt navigatie via de <a> in de row
      e.stopPropagation();
      toggleDropdown(li);
      return;
    }

    // 2) Klik op submenu item: sluit hele menu + dropdowns
    if (submenuLink) {
      menu.classList.remove('active');
      menuBtn.setAttribute('aria-expanded', 'false');
      document.body.classList.remove('no-scroll');
      closeAllDropdowns();
      return;
    }

    // 3) Klik op normale top-level link (Home/Over ons/Contact): sluit menu
    if (anyLink && !anyLink.closest('.nav-item-dropdown')) {
      menu.classList.remove('active');
      menuBtn.setAttribute('aria-expanded', 'false');
      document.body.classList.remove('no-scroll');
      closeAllDropdowns();
    }
  });

})();
</script>
  
</body>
</html>
